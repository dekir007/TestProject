# Тестовое задание по практикуму DWH

### Установка

0. Предполагается, что у вас установлен <code>docker</code>.
1. Скопируйте репозиторий
```
git clone https://github.com/dekir007/TestProject
```

> [!NOTE]
> Если у вас нет инструмента для работы с git, просто скачайте репозиторий по зеленой кнопке Code -> Download ZIP

2. Настройте <code>.env</code> файл на уровне папки <code>TestProject</code> 

> [!WARNING]
> Рекомендуется заменить название БД, имя и пароль <code>superuser</code> и <code>testproject</code> пользователя, через которого скрипт будет подключаться к БД, на свои!

Необходимые переменные окружения:
```
DBNAME='postgres'
POSTGRES_USER='postgres'
POSTGRES_PASSWORD='postgres'
PORT='5432'
TESTPROJECT_USER='testproject'
TESTPROJECT_PASSWORD='123123'
```
3. Настройте <code>.env</code> файл на уровне папки <code>src</code>

Здесь <code>POSTGRES_USER</code> и <code>POSTGRES_PASSWORD</code> используются для python скрипта. То есть подставляем сюда значения из <code>TESTPROJECT_USER</code> и <code>TESTPROJECT_PASSWORD</code> из пункта выше.

Необходимые переменные окружения:
```
DBNAME='postgres'
POSTGRES_USER='testproject'
POSTGRES_PASSWORD='123123'
HOST='db'
PORT='5432'
URL='https://cloud.mail.ru/public/L1xB/nvgHGYJz5'
```

> [!NOTE]
> Да, неприятное дублирование, я пробовал сделать один файл. Первый из 2-го пункта использует докер, а этот нужен для скрипта. И проблема в том, что в Dockerfile нельзя прописать COPY .env, он его не копирует! Буду благодарен, если скажите, почему.

4. В консоли на уровне папки <code>TestProject</code> пропишите:

```
docker-compose up
```

После чего поднимутся 2 контейнера: БД и скрипт, который сразу выполнится. Логи выполнения можно увидеть сразу в консоли, потому что мы не прописали флаг <code>-d</code>, запускающий в фоновом режиме. 

> [!TIP]
> Этот проект буквально мой первый опыт работы с докером. Слышал, что ожидание python контейнера поднятия БД контейнера не гарантирует, что БД будет сразу доступна (какое-то время будет инициализация или что-то еще, соединение не будет открыто). Поэтому прописывают bash скрипты для проверки, поднялась ли БД. Взял эту технику [отсюда](https://youtu.be/jCvmvWgKKSw). UPD: оказалось, это правда помогает!
